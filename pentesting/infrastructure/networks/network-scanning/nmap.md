# Nmap

## Host Discovery with Nmap



#### Custom host discovery with Nmap

```bash
nmap -PS21-25,80,110,139,443,445,623,3306,3389,8000,8080,8081,etc $subnet/24 -oA DiscoveredHosts
```

#### Exclude hosts from scans with Nmap by specifying IPs

```bash
nmap -sV -F --exclude 127.0.0.2,127.0.0.4 127.0.0.1/24
```

#### Exclude hosts from scans with Nmap by specifying file

```bash
nmap -sV -F --excludefile $file_name 127.0.0.1
```

#### Create a Live Hosts List

```bash
cat DiscoveredHosts.gnmap | awk '/Up$/{print $2}' > LiveIPs.txt
```

#### Perform a Full Scan on Live Hosts

```bash
nmap -p- -Pn -sV -sC -iL LiveIPs.txt -oA FullScanOutput
```

### Additional scans

#### Custom Discovery Scan

```bash
sudo nmap -Pn -n -sS -p $customports --min-hostgroup 255 --min-rtt-timeout 0ms --max-rtt-timeout 100ms --max-retries 1 --max-scan-delay 0 --min-rate 2000 -oA nmap-discovery -vvv -open -iL $targetfile
```

#### Custom Full Scan

```bash
sudo nmap -Pn -n -p- -sV --min-hostgroup 255 --min-rtt-timeout 25ms --max-rtt-timeout 100ms --max-retries 1 --max-scan-delay 0 --min-rate 1000 -oA full-nmap -vvv --open -iL $targetfile
```

#### Run a vulners scan

```bash
nmap -p- --script=vulners -iL LiveIPs.txt -oA VulnersScan
```

#### Run a default HTTP credential scan

```bash
nmap -p- --script=http-default-accounts -iL LiveIPs.txt -oA DefaultCredentialScan
```

### Parsing Nmap Scans

Metasploit's database is a great way to parse Nmap scans. Alternatively, try using the tool listed below:

{% embed url="https://github.com/leesoh/np" %}

The Nmap Scripting Engine (NSE) is one of Nmap's most powerful and flexible features. It allows users to write (and share) simple scripts (using the Lua programming language) to automate a wide variety of networking tasks.

TL;DR: NSE goes brrr

### Basic NSE usage

#### List all available NSE scripts

```bash
locate *.nse
```

#### Load default NSE scripts

```bash
nmap -sC $ip
```

#### Specify a specific NSE script

```bash
nmap --script=ssh2-enum-algos -p22 $ip
```

Specify a specific [category](https://nmap.org/book/nse-usage.html)``

```bash
nmap --script discovery,vuln $ip
```

#### Using a wildcard to use multiple relevant scripts (e.g., ssh)

```bash
nmap --script "ssh-*" -p22 $ip
```

### Useful NSE Scripts

This section includes NSE scripts that are not included with Nmap and should be manually added:

* [nndefaccts](https://github.com/nnposter/nndefaccts) - Alternate fingerprint dataset for Nmap script http-default-accounts
* [Nmap-Elasticsearch-NSE](https://github.com/theMiddleBlue/nmap-elasticsearch-nse) - Nmap NSE script for enumerating indices, plugins and cluster nodes on an elasticsearch target

## References

{% embed url="https://nmap.org/book/nse-usage.html" %}

### References

* [Nmap](https://nmap.org)
* [Awesome-Nmap-Grep](https://github.com/leonjza/awesome-nmap-grep#hosts-and-open-ports)
